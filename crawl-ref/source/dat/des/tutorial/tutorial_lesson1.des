##############################################
# Tutorial map 1: Movement and exploration   #
##############################################
#
# Important principles:
#  - no monsters, no items
#  - because of the above, needs to look particularly interesting
#
# Still TODO:
#  * Shorten the explanation on exclusions.
#  * Maybe send the player back to the entrance?
#
{{
require("dlua/tutorial.lua")

tutorial_msg = {}

function tutorial_msg.start ()
    tutorial_intro("In this lesson you're going to learn how to move around and "
                   .. "explore a level.")

    local text = "You can move "
    if crawl.is_tiles() and not crawl.is_webtiles() then
        text = text .. "by clicking somewhere with your <white>[Mouse]</white>, or "
    end
    text = text .. "with the <white>[arrow keys]</white>. "
    crawl.mpr(text, "tutorial")
end

function tutorial_msg.go_on ()
    return tutorial_message("You're doing great! Now, explore a bit until you "
                            .. "reach the next blue square.")
end

function tutorial_msg.diagonal ()
    local text = "You can move diagonally by way of the <white>[number pad]</white> (try Numlock on/off) or by using the <white>[vi keys]</white>.\n"
                 .. "  Numpad:       <white>7 8 9</white>           " .. "vi-keys:    " .. tutorial_get_cmd("CMD_MOVE_UP_LEFT") .. " "
                 .. tutorial_get_cmd("CMD_MOVE_UP") .. " " .. tutorial_get_cmd("CMD_MOVE_UP_RIGHT") .. "\n"
                 .. "                 \\|/                         " .. "\\|/\n"
                 .. "                <w>4</w>-<w>.</w>-<w>6</w>                       "
                 .. tutorial_get_cmd("CMD_MOVE_LEFT") .. "-<w>.</w>-" .. tutorial_get_cmd("CMD_MOVE_RIGHT") .. "\n"
                 .. "                 /|\\                         " .. "/|\\\n"
                 .. "                <white>1 2 3</white>                       " .. tutorial_get_cmd("CMD_MOVE_DOWN_LEFT") .. " "
                 .. tutorial_get_cmd("CMD_MOVE_DOWN") .. " " .. tutorial_get_cmd("CMD_MOVE_DOWN_RIGHT") .. "\n"
                 if crawl.is_tiles() and not crawl.is_webtiles() then
                                        text = text .. "You can also move using <white>[Mouse clicks]</white>"
                                end
    text = text .. "."
    return tutorial_message(text)
end

function tutorial_msg.shiftmove ()
    local text = "A quicker way to 'run' through a corridor is to press "
                 .. "<white>[Shift]</white> along with the <white>[number pad]</white> (try Numlock on/off) or <white>[vi keys]</white>."
    return tutorial_message(text)
end

function tutorial_msg.downstairs ()
    local text = "When standing on a staircase leading downwards, you can enter "
                 .. "the next level with <white>[</white>"
                 .. tutorial_get_cmd("CMD_GO_DOWNSTAIRS") .. "<white>]</white>"
    if crawl.is_tiles() and not crawl.is_webtiles() then
      text = text .. " or with <white>[Shift-Click]</white> on your character"
    end

    text = text .. ".\n"

    return tutorial_message(text)
end

-- The second part of the map.
function tutorial_msg.levelmap ()
    local text = "What's this? To find out where you are, "

    if crawl.is_webtiles() then
        text = text .. "have a look at the <white>minimap</white> to the right of "
                    .. "the screen."
    elseif crawl.is_tiles() then
        text = text .. "have a look at the <white>minimap</white> to the right of "
                    .. "the screen. You can have a closer look at a part of the "
                    .. "map with a <white>right mouseclick</white> and also can "
                    .. "travel there with a <white>leftclick</white>."
    else
        text = text .. "enter the overmap view with "
                    .. tutorial_get_cmd("CMD_DISPLAY_MAP")
                    .. " and then move the cursor around to look around the level. "
                    .. "You also can travel wherever your cursor is pointing by "
                    .. "pressing <white>.</white> or <white>Enter</white>. "
                    .. "Press <white>Escape</white> to return to the normal game mode."
    end

    return tutorial_message(text)
end

function tutorial_msg.autoexplore ()
    return tutorial_message("Exploring manually can get tedious after a while, "
                            .. "so you might want to let that happen automatically. "
                            .. "Try it by pressing <white>[</white>"
                            .. tutorial_get_cmd("CMD_EXPLORE") .. "<white>]</white>.")
end

function tutorial_msg.exclusion ()

    local text = "Some dangerous ground is marked with <white>exclusions</white>. "
                 .. "Autoexplore "

    if crawl.is_tiles() and not crawl.is_webtiles() then
        text = text .. "(including by mouseclick!) "
    end

    text = text .. "will not lead you into exclusions. Instead you will automatically stop.\n"
                .. "However, autoexplore will move you safely around exclusions so you may continue by pressing <white>[</white>"
                .. tutorial_get_cmd("CMD_EXPLORE") .. "<white>]</white>."

    return tutorial_message(text)
end

function tutorial_msg.autoexplore_announce ()
    local text = "Autoexplore will stop to announce features and items. To travel "
                 .. "directly to the stairs, you can "
    if crawl.is_tiles() and not crawl.is_webtiles() then
        text = text .. "click on them or you can "
    end
    text = text .. "press <w>[</w>"
                .. tutorial_get_cmd("CMD_DISPLAY_MAP") .. "<w> << Enter]</w>."
    return tutorial_message(text)
end

function tutorial_msg.tutorial_end ()
    local text = "Congratulations! You've completed the first lesson!\n"
                 .. "To exit the tutorial, simply go up these stairs with "
                 .. tutorial_get_cmd("CMD_GO_UPSTAIRS")
    if crawl.is_tiles() and not crawl.is_webtiles() then
      text = text .. " or by <white>Shift-clicking</white> on your character"
    end

    text = text .. ". Confirm the resulting prompt with an uppercase <white>Y</white>."

    return tutorial_message(text)
end


-----------------------------------------------------------
-- Lua code for level 2.
-----------------------------------------------------------
function tutorial_msg.newlevel ()
    local text = "A new level! To begin with, head over to that door to the right.\n"
                 .. "Also, remember: You can reread old messages with <white>[</white>"
                 .. tutorial_get_cmd("CMD_REPLAY_MESSAGES") .. "<white>]</white>."

    crawl.mesclr(true)
    crawl.mpr(text, "tutorial")
end

function tutorial_msg.door ()
    local text = "You can open a closed door by walking into it. To close an open "
                 .. "door, press <white>[</white>"
                 .. tutorial_get_cmd("CMD_CLOSE_DOOR") .. "<white>]</white>."
    return tutorial_message(text)
end

function tutorial_msg.secret_door_glass ()
    return tutorial_message("It doesn't look like the corridor ends here. Try "
                            .. "searching for a secret door with <white>[</white>"
                            .. tutorial_get_cmd("CMD_REST") .. "<white>]</white>.\n"
                            .. "This process might spend multiple turns.")
end

function tutorial_msg.water ()
    return tutorial_message("Note how you can move through shallow but not "
                            .. "through deep water.")
end

function tutorial_msg.secret_door_wall ()
    return tutorial_message("A dead-end! Or, wait... is it another secret door? "
                            .. "Try searching again with <white>[</white>"
                            .. tutorial_get_cmd("CMD_REST") .. "<white>]</white> once again.")
end

function tutorial_msg.upstairs ()
    local text = "When standing on a staircase leading upwards, you can enter "
                 .. "the previous level with <white>[</white>"
                 .. tutorial_get_cmd("CMD_GO_UPSTAIRS") .. "<white>]</white> "
    if crawl.is_tiles() and not crawl.is_webtiles() then
      text = text .. " or by <white>Shift-clicking</white> on your character"
    end

    text = text .. "."

    return tutorial_message(text)
end

function tutorial_msg.exit ()
    -- A single screen recapping all commands.

    local text = "<yellow>Movement commands</yellow>\n\n"
                 .. "  Numpad:       <white>7 8 9</white>           " .. "vi-keys:    " .. tutorial_get_cmd("CMD_MOVE_UP_LEFT") .. " "
                 .. tutorial_get_cmd("CMD_MOVE_UP") .. " " .. tutorial_get_cmd("CMD_MOVE_UP_RIGHT") .. "\n"
                 .. "                 \\|/                         " .. "\\|/\n"
                 .. "                <w>4</w>-<w>.</w>-<w>6</w>                       "
                 .. tutorial_get_cmd("CMD_MOVE_LEFT") .. "-<w>.</w>-" .. tutorial_get_cmd("CMD_MOVE_RIGHT") .. "\n"
                 .. "                 /|\\                         " .. "/|\\\n"
                 .. "                <white>1 2 3</white>                       " .. tutorial_get_cmd("CMD_MOVE_DOWN_LEFT") .. " "
                 .. tutorial_get_cmd("CMD_MOVE_DOWN") .. " " .. tutorial_get_cmd("CMD_MOVE_DOWN_RIGHT") .. "\n\n"
                 .. "<white>Shift + direction</white> moves you several squares into this direction.\n"

    if crawl.is_tiles() and not crawl.is_webtiles() then
        text = text .. "You also can move by <white>clicking</white> somewhere in sight or on the <white>minimap</white>.\n"
    end

    text = text .. "\n<yellow>Staircases</yellow>\n"
                .. "  " .. tutorial_get_cmd("CMD_GO_UPSTAIRS") .. "  go back to the previous level\n"
                .. "  " .. tutorial_get_cmd("CMD_GO_DOWNSTAIRS") .. "  enter the next level\n"
                .. "  " .. tutorial_get_cmd("CMD_DISPLAY_MAP") .. "<w><<</w>/<w>></w>" .. "  travel to the nearest up/downstairs\n"

    text = text .. "\n<yellow>Doors</yellow>\n"
                .. "  can be opened by walking into them\n"
                .. "  " .. tutorial_get_cmd("CMD_CLOSE_DOOR") .. "  close an open door\n"
                .. "  " .. tutorial_get_cmd("CMD_REST") .. "  search for secret doors\n"

    text = text .. "\n<yellow>Travel</yellow>\n"
    if crawl.is_tiles() and not crawl.is_webtiles() then
        text = text .. "  mouseclick on the <white>minimap</white>\n"
    else
        text = text .. "  " .. tutorial_get_cmd("CMD_DISPLAY_MAP") .. "  enter the level map, travel with <white>Enter</white>\n"
    end
    text = text .. "  " .. tutorial_get_cmd("CMD_EXPLORE") .. "  autoexplore\n"
                .. "                                 <cyan>Press <white>any key</white> to clear this screen...</cyan>\n"

    return crawl.endgame(text)
end

function tutorial_msg.win()
    crawl.mark_game_won()
    return tutorial_msg.exit()
end
}}

NAME:    tutorial_lesson1
TAGS:    no_rotate no_monster_gen no_item_gen no_hmirror no_vmirror no_trap_gen no_pool_fixup tutorial
DESC:    "Lesson 1: Movement and Exploration"
ORIENT:  encompass
KFEAT:   ABCDE = .
KFEAT:   HFI = '
COLOUR:  ABCDEFHI = lightblue
COLOUR:  ' = brown
FTILE:   G'[ = floor_swamp, t = floor_grass
FTILE:   ABCDEFHI$ = tutorial_pad
MARKER:  A = lua:tutorial_msg.go_on()
MARKER:  B = lua:tutorial_msg.diagonal()
MARKER:  C = lua:tutorial_msg.shiftmove()
MARKER:  ) = lua:tutorial_msg.downstairs()
MARKER:  } = lua:tutorial_msg.levelmap()
MARKER:  F = lua:tutorial_msg.autoexplore()
MARKER:  H = lua:tutorial_msg.exclusion()
MARKER:  I = lua:tutorial_msg.autoexplore_announce()
MARKER:  [ = lua:tutorial_msg.tutorial_end()
MARKER:  { = lua:one_way_stair { dst  = "tutorial_lesson1", \
                                 onclimb = "tutorial_msg.exit" }
MARKER:  [ = lua:one_way_stair { desc = "exit from the tutorial", \
                                 dst  = "tutorial_lesson1", \
                                 onclimb = "tutorial_msg.win" }
MARKER:  l = lua:fog_machine { cloud_type = "steam", pow_min = 10, \
             pow_max = 10, delay = 10, start_clouds = 1, size_min = 2, \
             size_max = 2, spread_rate = 0 }
epilogue{{
  tutorial_msg.start()
}}
MAP
xxxxxxxxxxxxxxxxxxxxxxttttttttttttttttttxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxttttttttttttttttttttttxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxtttttttttt'''tttttttttttttxxxxxxxxx
xxxxxxxxxxxxxxxxxttttttttttt'''''tttttttttttttttxxxxxx
xxxxxxxxxxxxxxxxxtttttttttt'''''''tttttttttttttttxxxxx
xxxxxxxxxxxxxxxxxxttttttttt'''[''''''ttttttttttttttxxx
xxxxxxxxxxxxxxxxxxttttttttt'''''''ttt'I''ttttttttttttx
xxxxxxxxxxxxxxxxxxtttttttttt'''''tttttttt'''tttttttttt
xxxxxxxxxxxxxxxxxxxtttttttttt'''tttttttttttt''tttttttt
xxxxxxxxxxxxxxxxxxxxxxtttttttttttttttttttttttt'ttttttt
xxxxxxxxxxxxxxxxxxxxxxxxxtttttttttttttttttttttt'tttttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxtttttttttttttttttttt'tttttt
xx.....xxxxxxxxxxxxxxxxxxxxxxttttttttttttttttt'ttttttt
xx..{......A.xxxxxxxxxx.xxxxxxxxttttttttttttt'tttttttt
xx.....xxxxx.xxxxxxxxx...xxxxxxxxtttttttttt''ttttttttt
xxxxxxxxxxxx.xxxxxxxx..)..xxxxxxxxxttttt'''ttttttttttt
xxxxxxxxxxx......xxxxx...xxxxxxxxxttttt'''''tttttttttt
xxxxxxxxxxxxxxx..xxxxxx.x.xxxxxxxttttt''WWW''ttttttttt
xxxxxxxxxxx......xxxxxxxxx.xxxxxxttttt''WlW''ttttttttt
xxxxxxxxxxx..xxxxxxxxxxxxxx.xxxxxttttt''WWW''ttttttttt
xxxxxxxxxxx.......Bxxxxxxxxx.xxxxtttttt'''''tttttttttt
xxxxxxxxxxxxxxxxxxx.xxxxxxx.xxxxxttttttt'''ttttttttttt
xxxxxxxxxxxxxxxxxxxx.xxxxx.xxxxxxxtttttttHtttttttttttt
xxxxxxxxxxxxxxxxxxxxx.xxx.xxxxxxxtttttt''ttttttttttttt
xxxxxxxxxxxxxxxxxxxxxx.x.xxxxxtxtttttt'ttttttttttttttt
xxxxxxxxxxxxxxxxxxxxxxxCxxxxxxttttttt'tttttttttttttttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxtttttt'tttttttttttttttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxttttttt'ttttttttttttttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxtttttttt''ttttttt'ttttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxtttttttt'''ttt'''tttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxtttttttttt'F''}''ttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxttttttttttttt'''tttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxtttttttttttt'ttttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxtttttttttttttttt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxtttttttxx
ENDMAP

##########################################################
# Level 2: Shift-move and secret doors
##########################################################
NAME:    tutorial_lesson1_level2
TAGS:    no_rotate no_monster_gen no_item_gen no_hmirror no_vmirror no_trap_gen no_pool_fixup tutorial_lesson1
PLACE:   D:2
ORIENT:  encompass
KFEAT:   ABCD = .
COLOUR:  ABCD = lightblue
FTILE:   ABCD = tutorial_pad
MARKER:  A = lua:tutorial_msg.door()
MARKER:  B = lua:tutorial_msg.secret_door_glass()
MARKER:  C = lua:tutorial_msg.water()
MARKER:  D = lua:tutorial_msg.secret_door_wall()
MARKER:  { = lua:tutorial_msg.upstairs()
MARKER:  l = lua:fog_machine { cloud_type = "steam", pow_min = 10, \
             pow_max = 10, delay = 10, start_clouds = 1, size_min = 2, \
             size_max = 2, spread_rate = 0 }
epilogue{{
  tutorial_msg.newlevel()
}}
MAP
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvv.www.vvvvvvvvvvvvv
vv.....vvvv.n.vvv.wwwww.vvv...vvvvvv
vv.(..A+...B=.....wwwww..D=.{.vvvvvv
vv.....vvvv.n.vvv.wwwww.vvv...vvvvvv
vvvvvvvvvvvvvvvvv.wwwww.vvvvvvvvvvvv
vvvvvvvvvvvvvvvvvCwwwww.vvvvvvvvvvvv
vvvvvvvvvvvvvvvvv..www..vvvvvvvvvvvv
vvvvvvvvvvvvvvvvvv.www.vvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvv.WWW.vvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
vvvvvvvvvvvvvvvvvvvwwwvvvvvvvvvvvvvv
ENDMAP
